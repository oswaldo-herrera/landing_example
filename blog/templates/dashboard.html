{% extends 'layout.html' %}

{% block content %}

<style>
  body{
    background:#9c9c9c;
    
  }
  .text-xs{
    font-size: 13px;
  }
</style>

<div class="mt-4 pt-5 p-5 border">
  <div class="mt-2 mb-3">
    <h4>Panel de Administración </h4>
    <span class="text-xs"> Aqui podrás cambiar las imagenes de cada sección de tu página web</span>
  </div>

  <div class="accordion " id="accordionExample">
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingOne">
        <button class="accordion-button bg-secondary text-white" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
          Imagen Principal 
        </button>
      </h2>
      <div id="collapseOne" class="accordion-collapse collapse " aria-labelledby="headingOne" data-bs-parent="#accordionExample">
        <div class="accordion-body bg-dark">
          <h1 class="d-none"> Cargar Imagen Principal</h1>
          <form id="form-headers" method="post" enctype="multipart/form-data" class="bg-dark p-3  "  action="{% url 'blog:imagen_header' %}" >
            {% csrf_token %}
            {{ image_header_form.as_p }}
           
            <br>
            <button type="submit" class="btn btn-outline-success btn-sm" id="submit-header">Guardar</button>
            <a href="{% url 'home' %}" class=" btn btn-outline-danger btn-sm border-secondary ">Cancelar</a>
          </form>
        </div>
      </div>
    </div>
  
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingTwo">
        <button class="accordion-button collapsed bg-secondary text-white" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
          Imàgenes Segunda Sección 
        </button>
      </h2>
      <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
        <div class="accordion-body bg-dark">
          <h1 class="d-none"> Crear Imàgenes Segunda Secciòn</h1>
          <form  method="post" enctype="multipart/form-data" class="bg-dark p-3 " action="{% url 'blog:imagen_spot' %}">
            {% csrf_token %}
            {{ image_spot_form.as_p }}      
            <br>
            <button type="submit" class="btn btn-outline-success btn-sm"  >Guardar</button>
            <a href="{% url 'home' %}" class=" btn btn-outline-danger btn-sm border-secondary ">Cancelar</a>
          </form>
        </div>
      </div>
    </div>
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingThree">
        <button class="accordion-button collapsed bg-secondary text-white" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
          Texto Segunda Sección 
        </button>
      </h2>
      <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
        <div class="accordion-body bg-dark">
          <h1 class="d-none"> Crear Texto Segunda Secciòn</h1>
          <form  method="post" enctype="multipart/form-data" class="bg-dark p-3 " action="{% url 'blog:texto_spot' %}" >
            {% csrf_token %}
            {{ text_spot_form.as_p }}
            <br>
            <button type="submit" class="btn btn-outline-success btn-sm" >Guardar</button>
            <a href="{% url 'home' %}" class=" btn btn-outline-danger btn-sm border-secondary ">Cancelar</a>
          </form>
        </div>
      </div>
    </div>
  
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingFive">
        <button class="accordion-button collapsed bg-secondary text-white" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
          Primer Titulo <span class=""> : Es el titulo que esta entre las lineas  </span>
        </button>
      </h2>
      <div id="collapseFive" class="accordion-collapse collapse" aria-labelledby="headingFive" data-bs-parent="#accordionExample">
        <div class="accordion-body bg-dark">
          <h1 class="d-none">Seccion Uno</h1>
          <form  method="post" enctype="multipart/form-data" class="bg-dark p-3 " action="{% url 'blog:seccion_uno' %}">
            {% csrf_token %}
            {{ seccion_uno_form.as_p }}
            
            <button type="submit" class="btn btn-outline-success btn-sm"  >Guardar</button>
            <a href="{% url 'home' %}" class="btn btn-outline-danger btn-sm border-secondary ">Cancelar</a>
          </form>
        </div>
      </div>
    </div>
  
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingFour">
        <button class="accordion-button collapsed bg-secondary text-white" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
          Segundo Titulo <span class=""> : Es el segundo titulo que esta entre las lineas  </span>
        </button>
      </h2>
      <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#accordionExample">
        <div class="accordion-body bg-dark">
          <h1 class="d-none"> Seccion Dos</h1>
          <form  method="post" enctype="multipart/form-data" class="bg-dark p-3 " action="{% url 'blog:seccion_dos' %}" >
            {% csrf_token %}
            {{ seccion_dos_form.as_p }}
            <br>
            <button type="submit" class="btn btn-outline-success btn-sm" >Guardar</button>
            <a href="{% url 'home' %}" class=" btn btn-outline-danger btn-sm border-secondary ">Cancelar</a>
          </form>
        </div>
      </div>
    </div>
  
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingSeven">
        <button class="accordion-button collapsed bg-secondary text-white" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSeven" aria-expanded="false" aria-controls="collapseSeven">
          Crear Producto <span class=""> : Aqui creas los productos que se enlistaran   </span>
        </button>
      </h2>
      <div id="collapseSeven" class="accordion-collapse collapse" aria-labelledby="headingSeven" data-bs-parent="#accordionExample">
        <div class="accordion-body bg-dark">
          <h1 class="d-none">{{ view.action }} Crear Producto</h1>
          <form id="form-producto" method="post" enctype="multipart/form-data" class="bg-dark p-3 " action="{% url 'blog:crear_portafolio' %}">
            {% csrf_token %}
            {{ project_form.as_p }}
            
            <button type="submit" class="btn btn-outline-success btn-sm"  id="submit-producto">Guardar</button>
            <a href="{% url 'home' %}" class=" btn btn-outline-danger btn-sm border-secondary ">Cancelar</a>
          </form>
        </div>
      </div>
    </div>
  
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingSix">
        <button class="accordion-button collapsed bg-secondary text-white" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSix" aria-expanded="false" aria-controls="collapseSix">
          Subir Video <span class=""> : Aqui puedes subir videos guardados de tu PC o Celular y tambien de Youtube    </span>
        </button>
      </h2>
      <div id="collapseSix" class="accordion-collapse collapse" aria-labelledby="headingSix" data-bs-parent="#accordionExample">
        <div class="accordion-body bg-dark">
          <h1 class="d-none"> Subir Video</h1>
          <form  method="post" enctype="multipart/form-data" class="bg-dark p-3 " action="{% url 'blog:video_view' %}" >
            {% csrf_token %}
            {{ video_form.as_p }}
            <br>
            <button type="submit" class="btn btn-outline-success btn-sm" >Guardar</button>
            <a href="{% url 'home' %}" class="btn btn-outline-danger btn-sm border-secondary ">Cancelar</a>
          </form>
        </div>
      </div>
    </div>
  
    
  </div>
</div>



<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const formHeader = document.getElementById("form-header");
    const imageInputHeader = formHeader.querySelector('input[type="file"]');
    let isSubmitting = false;
  
    formHeader.addEventListener("submit", function (event) {
      // Prevenir el envío inicial del formulario solo si la imagen no es válida
      event.preventDefault();
  
      // Si ya se está enviando, salir
      if (isSubmitting) {
        return;
      }
  
      const file = imageInputHeader.files[0];
  
      // Validar si hay un archivo seleccionado
      if (!file) {
        Swal.fire({
          icon: "error",
          title: "Error",
          text: "Por favor, selecciona una imagen.",
        }).then(() => {
          imageInputHeader.focus();
        });
        return;
      }
  
      // Validar que el nombre del archivo no contenga espacios
      if (file.name.includes(" ")) {
        Swal.fire({
          icon: "error",
          title: "Nombre de archivo inválido",
          text: "El nombre del archivo no debe contener espacios. Por favor, renómbralo.",
        }).then(() => {
          imageInputHeader.value = ""; // Limpiar el input de archivo
          imageInputHeader.focus(); // Regresar el foco al input
        });
        return;
      }
  
      // Crear objeto URL temporal para la imagen
      const img = new Image();
      const objectUrl = URL.createObjectURL(file);
      img.src = objectUrl;
  
      img.onload = function () {
        const width = img.naturalWidth;
        const height = img.naturalHeight;
  
        // Liberar memoria del archivo
        URL.revokeObjectURL(objectUrl);
  
        // Validar dimensiones de la imagen
        if (width !== 2000 || height !== 500) {
          Swal.fire({
            icon: "error",
            title: "Dimensiones incorrectas",
            text: "La imagen debe tener un ancho de 2000 píxeles y un alto de 500 píxeles.",
          }).then(() => {
            imageInputHeader.value = ""; // Limpiar el input de archivo
            imageInputHeader.focus(); // Regresar el foco al input
          });
          return;
        }
  
        // Si la imagen es válida, permitir el envío
        isSubmitting = true;
  
        // Usar submit() de manera correcta (sin prevenirlo más)
        formHeader.submit(); // Solo se envía el formulario correspondiente
      };
  
      img.onerror = function () {
        // Liberar memoria del archivo en caso de error
        URL.revokeObjectURL(objectUrl);
  
        Swal.fire({
          icon: "error",
          title: "Error",
          text: "El archivo seleccionado no es una imagen válida.",
        }).then(() => {
          imageInputHeader.value = ""; // Limpiar el input de archivo
          imageInputHeader.focus();
        });
      };
    });
  });
</script>





{% endblock %}